<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="../static/css/chatting.css" />
    <script
      src="https://code.jquery.com/jquery-3.6.1.min.js"
      integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
      crossorigin="anonymous"
    ></script>
    <!-- 이상 Jquery CDN -->
    <script
      src="https://cdn.socket.io/4.5.0/socket.io.min.js"
      integrity="sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k"
      crossorigin="anonymous"
    ></script>
    <!-- 이상 소켓 cdn -->
    <script>
      $(document).ready(
        function(){
          var data = {
          sendNick: `<%=sendNick%>`,
        };
        socket.emit("chatEntry", data);
        socketEvent();
        console.log("entrySuccess");
      })
    </script>
  </head>
  <body>
    <!-- <button type="button" onclick="chat()">누구와의채팅</button> -->
    
    <div class="wrap">
      <div class="chatList" id="chatList">
        chatList<br>
        myNick : <input 
        id="sendNick"
        value="<%=sendNick%>" 
        type="text" 
        readonly
        style="text-align: center;"
        ><br>
        <div class="room_list"><a href="/chatting/1">room1</a></div>
        <!-- <div class="room_list"><a href="/chatting/2">room2</a></div>
        <div class="room_list"><a href="/chatting/3">room3</a></div>
        <div class="room_list"><a href="/chatting/4">room4</a></div> -->

        
      </div>
      <div class="chatBox" id="chatBox">
        chatBox
        <div class="sendBox">
          <input
            class="msgBox"
            placeholder="전송할 내용을 입력해주세요"
            value=""
          />
          <button class="sendBtn" onclick="send()">전송</button>
        </div>
      </div>
    </div>
    <script>
      var socket = io.connect();
      var sendNick;
      let params = (new URL(document.location)).searchParams;
      console.log('params', '<%=params%>')
      socket.emit('create', `room${'<%=params%>'}`);    

      console.log(socket);

      // function chat() {
      //   socket.on("chat", (data)=>{
      //     console.log(data);
      //     let chat_list = document.getElementById("chatList");
      //     let div = document.createElement("div");
      //     let div_chatroom = document.createElement("div");

      //     div.classList.add("chat_room");
      //     div_chatroom.textContent += data.sendNick + " & "
      //   })
      // }

      function send() {
        console.log($(".msgBox").val());
        var data = {
          sendNick: `<%=sendNick%>`,
          msg: $(".msgBox").val(),
        };
        console.log(data.sendNick);
        socket.emit("send", data);
      }

      function socketEvent() {
        socket.on("newMessage", (data) => {
          let chat_box = document.getElementById("chatBox");
          let div = document.createElement("div");
          let div_chat = document.createElement("div");
          if (data.sendNick) div.classList.add("my-chat");
          else div.classList.add("other-chat");
          console.log(sendNick);
          // console.log(data);
          div_chat.textContent += data.sendNick + " : " + data.msg;
          div.appendChild(div_chat);
          chat_box.appendChild(div);
        });
      } // 입장 공지
    </script>
  </body>
</html>
